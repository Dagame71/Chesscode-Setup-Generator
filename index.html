<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chesscode Setup Generator</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100%;
      font-family: 'Courier New', Courier, monospace;
      touch-action: manipulation;
      background: url('/mnt/data/sfondo.png') no-repeat center center;
      background-size: contain;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background-color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
      padding: 10px;
      gap: 10px;
      max-height: 100vh;
      overflow-y: auto;
    }

    .title {
      text-align: center;
    }
    .title h1 { margin: 0; font-size: 32px; }
    .title h2 { margin: 0; font-size: 18px; font-weight: normal; }

    .header {
      display: flex;
      gap: 40px;
    }
    .header .button {
      padding: 5px 10px;
      font-size: 18px;
      background-color: white;
      border: 2px solid black;
      cursor: pointer;
    }

    .setup-block {
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 22px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .icon {
      width: 22px;
      height: 22px;
      object-fit: contain;
    }

    .start-point {
      font-size: 22px;
      text-align: center;
    }

    .dice-area { text-align: center; }
    .dice-box {
      width: 100px;
      height: 100px;
      background-color: white;
      border: 2px solid black;
      font-size: 40px;
      line-height: 100px;
      cursor: pointer;
      display: inline-block;
      margin: 0 10px;
      vertical-align: top;
    }

    .presidio-button, .field-button {
      display: none;
      margin-top: 20px;
      padding: 5px 10px;
      font-size: 16px;
      background-color: white;
      border: 2px solid black;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
   <div class="title">
  <img src="title.png" alt="Chesscode Setup Generator" width="232" height="auto">
</div>
    <div class="header">
      <button id="chapter1" class="button">Chapter I</button>
      <button id="chapter2" class="button">Chapter II</button>
    </div>

    <div class="setup-block">
      <div class="column" id="leftBlock">
        <div class="row"><img src="q.jpg" class="icon" alt="Q"><div id="leftVal0"></div></div>
        <div class="row"><img src="k.jpg" class="icon" alt="K"><div id="leftVal1"></div></div>
        <div class="row"><img src="n.jpg" class="icon" alt="N"><div id="leftVal2"></div></div>
        <div class="row"><img src="b.jpg" class="icon" alt="B"><div id="leftVal3"></div></div>
        <div class="row"><img src="r.jpg" class="icon" alt="R"><div id="leftVal4"></div></div>
        <div class="row"><img src="p.jpg" class="icon" alt="P"><div id="leftVal5"></div></div>
      </div>

      <div class="column" id="rightBlock" style="align-items: flex-end;">
        <div class="row"><img src="camera.jpg" class="icon" alt="Camera"><div id="rightVal0"></div></div>
        <div class="row"><img src="finger.jpg" class="icon" alt="Finger"><div id="rightVal1"></div></div>
        <div class="row"><img src="gun.jpg" class="icon" alt="Gun"><div id="rightVal2"></div></div>
        <div class="row"><img src="scope.jpg" class="icon" alt="Scope"><div id="rightVal3"></div></div>
        <div class="row"><img src="folder.jpg" class="icon" alt="Folder"><div id="rightVal4"></div></div>
        <div class="row"><img src="skull.jpg" class="icon" alt="Skull"><div id="rightVal5"></div></div>
      </div>
    </div>

    <div class="start-point" id="startPoint">Starting point: </div>

    <div class="dice-area">
      <div class="dice-box" id="diceBox"></div>
      <div class="dice-box" id="diceBox2" style="display:none;"></div>
      <br>
      <button id="fieldButton" class="field-button">Field Event</button>
      <button id="presidioButton" class="presidio-button">Presidio Nemico</button>
    </div>
  </div>

  <script>
    const getRandomCoord = () => `${Math.ceil(Math.random()*6)}-${Math.ceil(Math.random()*6)}`;

    const getValidCoords = () => {
      const coords = [];
      let tries = 0;
      while(coords.length < 6 && tries < 1000) {
        const y = Math.ceil(Math.random()*6), x = Math.ceil(Math.random()*6);
        const c = `${y}-${x}`;
        const yCount = coords.filter(v => +v.split('-')[0] === y).length;
        const xCount = coords.filter(v => +v.split('-')[1] === x).length;
        const edgeCount = coords.reduce((a,v) => {
          const [cy,cx] = v.split('-').map(Number);
          return a + ((cy===1||cy===6||cx===1||cx===6) ? 1 : 0);
        }, 0);
        if(!coords.includes(c) && yCount < 2 && xCount < 2 && edgeCount < 3) coords.push(c);
        tries++;
      }
      return coords;
    };

    const getUniqueNumbers = (min,max) => {
      const nums = [];
      while(nums.length < 6) {
        const n = Math.floor(Math.random()*(max-min+1)) + min;
        if(!nums.includes(n)) nums.push(n);
      }
      return nums;
    };

    const generateSetup = (ch) => {
      const startP = document.getElementById('startPoint');
      const d1 = document.getElementById('diceBox2');
      const pb = document.getElementById('presidioButton');
      const fb = document.getElementById('fieldButton');

      let ln, rn;
      if(ch === 1) {
        ln = getUniqueNumbers(4,9);
        rn = getUniqueNumbers(1,6);
        d1.style.display = 'none'; pb.style.display = 'none'; fb.style.display = 'inline-block';
      } else {
        ln = getUniqueNumbers(1,6);
        rn = getUniqueNumbers(1,6);
        d1.style.display = 'inline-block'; pb.style.display = 'inline-block'; fb.style.display = 'none';
      }

      let coords = [];
      while(coords.length < 6) coords = getValidCoords();

      let sp;
      do { sp = getRandomCoord(); } while(coords.includes(sp));

      ln.forEach((v,i) => {
        const el = document.getElementById(`leftVal${i}`);
        const lab = ch===1 ? ['Q','K','N','B','R','P'][i] : '';
        el.innerText = ch===1 ? `${lab} ${v} (${coords[i]})` : v;
      });

      rn.forEach((v,i) => {
        const el = document.getElementById(`rightVal${i}`);
        el.innerText = v;
      });

      startP.innerText = `Starting point: ${sp}`;
    };

    const rollDice = () => Math.ceil(Math.random()*6);
    document.getElementById('chapter1').onclick = () => generateSetup(1);
    document.getElementById('chapter2').onclick = () => generateSetup(2);
    document.getElementById('presidioButton').onclick = () => {
      document.getElementById('diceBox').innerText = rollDice();
      document.getElementById('diceBox2').innerText = rollDice();
    };
    document.getElementById('fieldButton').onclick = () => {
      document.getElementById('diceBox').innerText = rollDice();
    };
    document.getElementById('diceBox').onclick = () => {
      document.getElementById('diceBox').innerText = rollDice();
    };
  </script>
</body>
</html>
